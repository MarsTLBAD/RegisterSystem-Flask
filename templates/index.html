<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/sweetalert.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='css/bootstrap-table.min.css') }}">

    <script src="{{ url_for('static',filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/popper.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/sweetalert-dev.js') }}"></script>
    <script src="{{ url_for('static',filename='js/bootstrap-table.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/bootstrap-table-zh-CN.min.js') }}"></script>
    <style>
        .danger {
            color: red;
            font-weight: bold;
        }

        .safe {
            color: green;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div style="text-align: center;">
    <h2>体温登记</h2>
</div>
<table class="table table-hover" id="recordTable">
    <thead>
    <tr>
        <th>学号</th>
        <th>姓名</th>
        <th>体温</th>
        <th>日期</th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <form id="recordForm">
            <td>
                <div class="input-group">
                    <label for="id"></label>
                    <input type="text" class="form-control" id="id" name="id" placeholder="请输入学号">
                </div>
            </td>
            <td>
                <div class="input-group">
                    <label for="name"></label>
                    <input type="text" class="form-control" id="name" name="name" placeholder="请输入姓名">
                </div>
            </td>
            <td>
                <div class="input-group">
                    <label for="tem"></label>
                    <input type="text" class="form-control" id="tem" name="tem" placeholder="请输入体温">
                </div>
            </td>
            <td>
                <div class="input-group">
                    <label for="date"></label>
                    <input type="date" class="form-control" id="date" name="date" placeholder="请选择日期">
                </div>
            </td>
            <td>
                <button type="button" class="btn btn-primary" onclick=submitRecord()>提交</button>
            </td>
        </form>
    </tr>

    {% for i in record %}
        <tr>
            <td>{{ i.id }}</td>
            <td>{{ i.name }}</td>

            {% if i.temperature > 37.5 %}
                <td class="danger">{{ i.temperature }}</td>
            {% else %}
                <td class="safe">{{ i.temperature }}</td>
            {% endif %}

            <td>{{ i.date }}</td>
            <td>
                <button type="button" class="btn btn-danger" onclick=delRecord("{{ i.id }}")>删除</button>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>


<script>
    $('#recordTable').bootstrapTable({
        //是否显示分页条
        pagination: true,
        //一页显示的行数
        pageSize: 5,
        //是否开启分页条无限循环，最后一页时点击下一页是否转到第一页
        paginationLoop: false,
        //选择每页显示多少行，数据过少时可能会没有效果
        pageList: [5, 10, 20]
    })

    function sendAjax(param, url, callback) {
        $.ajax({
            async: false,
            ache: false,
            type: 'POST',
            url: url,
            data: JSON.stringify(param),
            dataType: "text",
            success: function (data) {
                var value = $.parseJSON(data).result
                callback(value)
            },
            error: function (data) {
                //错误处理
            }
        })
    }

    function submitRecord() {
        var data = {};
        data['id'] = $('#id').val()
        data['name'] = $('#name').val()
        //将体温转换为浮点数
        data['tem'] = parseFloat($('#tem').val())
        data['date'] = $('#date').val()
        if (data['tem'] < 35 || data['tem'] > 42) {
            swal({
                title: "请输入正常范围的体温",
                text: "体温范围35-42℃",
                type: "error"
            }, function () {
                $('#tem').val("")
            })
            return
        }
        sendAjax(data, '/add', submitCallback)
    }

    function submitCallback(value) {
        if (value === 1) {
            swal({
                title: "提交成功",
                text: "",
                type: "success",
                timer: 2000
            }, function () {
                location.reload()
            })
        }
        if (value === 0) {
            swal("上交失败", "请重试", "error")
        }
        if (value === -1) {
            swal({
                title: "该学生体温已提交",
                text: "请勿重复提交",
                type: "warning"
            }, function () {
                $('#recordForm')[0].reset()
            })
        }
    }

    function delRecord(id) {
        swal({
                title: "您确定要删除该记录吗",
                text: "删除后将无法恢复，请谨慎操作！",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "确认",
                cancelButtonText: "取消",
                closeOnConfirm: false,
                closeOnCancel: false
            },
            function (isConfirm) {
                if (isConfirm) {
                    var data = {'id': id}
                    sendAjax(data, '/del', delCallback)
                    return
                }
                swal({
                    title: "已取消",
                    text: "您取消了删除操作！",
                    type: "warning"
                })
            }
        )
    }

    function delCallback(value) {
        if (value === 1) {
            swal({
                title: "删除成功",
                text: "",
                type: "success",
                timer: 2000
            }, function () {
                location.reload()
            })
            return
        }
        if (value === -1) {
            swal("删除失败", "请重试", "error")
        }
    }
</script>
</body>
</html>